generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserInfo {
  userId            String          @id @default(cuid())
  userEmail         String          @unique
  username          String
  password          String
  avatar            String?
  describeBySelf    String?
  registrationTime  DateTime        @default(now())
  lover             String
  score             Int             @default(0)
  favourites        FavouriteList[]
  publishedGifts    GiftList[]      @relation("PublisherGifts")
  publishedTasks    TaskList[]      @relation("PublisherTasks")
  receivedTasks     TaskList[]      @relation("ReceiverTasks")
  publishedWhispers WhisperList[]   @relation("PublisherWhispers")
  receivedWhispers  WhisperList[]   @relation("ReceiverWhispers")

  @@map("userinfo")
}

model TaskList {
  taskId         String    @id @default(cuid())
  publisherEmail String
  receiverEmail  String?
  taskName       String
  taskDesc       String?
  taskImage      String?
  taskScore      Int       @default(0)
  taskStatus     String    @default("未开始")
  creationTime   DateTime  @default(now())
  completionTime DateTime?
  isApprove      Boolean   @default(false)
  publisher      UserInfo  @relation("PublisherTasks", fields: [publisherEmail], references: [userEmail])
  receiver       UserInfo? @relation("ReceiverTasks", fields: [receiverEmail], references: [userEmail])

  @@map("tasklist")
}

model GiftList {
  giftId         String   @id @default(cuid())
  publisherEmail String
  giftImg        String?
  giftName       String
  giftDetail     String?
  needScore      Int      @default(0)
  remained       Int      @default(0)
  isShow         Boolean  @default(true)
  creationTime   DateTime @default(now())
  publisher      UserInfo @relation("PublisherGifts", fields: [publisherEmail], references: [userEmail])

  @@map("gift_list")
}

model WhisperList {
  whisperId      String    @id @default(cuid())
  publisherEmail String
  toUserEmail    String?
  title          String?
  content        String
  creationTime   DateTime  @default(now())
  isRead         Boolean   @default(false)
  publisher      UserInfo  @relation("PublisherWhispers", fields: [publisherEmail], references: [userEmail])
  receiver       UserInfo? @relation("ReceiverWhispers", fields: [toUserEmail], references: [userEmail])

  @@map("whisper_list")
}

model FavouriteList {
  favId          String   @id @default(cuid())
  userEmail      String
  collectionId   String
  collectionType String
  creationTime   DateTime @default(now())
  user           UserInfo @relation(fields: [userEmail], references: [userEmail])

  @@unique([userEmail, collectionId, collectionType])
  @@map("favourite_list")
}

model SystemConfig {
  id          String   @id @default(cuid())
  configKey   String   @unique
  configValue String
  configType  String
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("system_configs")
}

model ImageBedConfig {
  id          String   @id @default(cuid())
  bedName     String   @unique
  bedType     String
  apiUrl      String
  apiKey      String?
  authHeader  String?
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  priority    Int      @default(0)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("image_bed_configs")
}

model NotificationConfig {
  id          String   @id @default(cuid())
  notifyType  String   @unique
  notifyName  String
  webhookUrl  String?
  apiKey      String?
  isActive    Boolean  @default(true)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("notification_configs")
}
